<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encomenda Online - SABOR A√áA√çTERIA</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .bg-gradient-custom {
            background-image: linear-gradient(to top right, #4f008a, #a100ff);
        }
        /* Custom Scrollbar for modals (WebKit/Safari compatible) */
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }
        .modal-body::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .modal-body::-webkit-scrollbar-thumb {
            background: #c084fc; /* purple-400 */
            border-radius: 10px;
        }
        .modal-body::-webkit-scrollbar-thumb:hover {
            background: #a855f7; /* purple-500 */
        }
        /* Hide number input arrows for a cleaner look (WebKit/Safari compatible) */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield; /* Firefox */
        }
        /* Style for disabled checkboxes to make limits clear */
        input[type="checkbox"]:disabled + span {
            color: #9ca3af; /* gray-400 */
            cursor: not-allowed;
        }
        /* Custom alert modal with transitions for Safari */
        .alert-modal {
            -webkit-transition: opacity 0.3s ease-in-out;
            transition: opacity 0.3s ease-in-out;
        }
        .alert-modal > div {
             -webkit-transition: -webkit-transform 0.3s ease-in-out;
             transition: transform 0.3s ease-in-out;
        }
        /* Added Safari compatibility for transform properties */
        .hover\:scale-110:hover {
            -webkit-transform: scale(1.1);
            transform: scale(1.1);
        }
        .scale-95 {
            -webkit-transform: scale(.95);
            transform: scale(.95);
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 sm:p-8 max-w-4xl">

        <!-- Header Section -->
        <header class="text-center mb-8 p-6 rounded-2xl bg-gradient-custom text-white shadow-lg">
            <h1 class="text-5xl md:text-6xl font-black tracking-tight">SABOR A√áA√çTERIA</h1>
            <p class="text-lg md:text-xl mt-2 opacity-90">Crie a sua encomenda online de forma f√°cil e r√°pida!</p>
        </header>

        <main class="space-y-8">

            <!-- Products Section -->
            <section id="tamanhos" class="bg-white p-6 rounded-2xl shadow-md">
                <h2 class="text-3xl font-bold text-purple-800 mb-4 border-b-2 border-purple-200 pb-2">Escolha o Tamanho</h2>
                <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Products will be dynamically injected by JavaScript -->
                </div>
            </section>

        </main>

        <!-- Footer -->
        <footer class="text-center mt-10">
            <p class="text-gray-600 mt-2">Siga-nos no Instagram: 
                <a href="#" class="font-semibold text-purple-700 hover:underline">@sabor_acaiteria</a>
            </p>
        </footer>
    </div>

    <!-- Floating Cart Button -->
    <div id="cart-button" class="fixed bottom-5 right-5 z-50 hidden">
        <button onclick="toggleCartModal()" class="bg-purple-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center hover:bg-purple-700 transition-transform transform hover:scale-110">
            <i class="fas fa-shopping-cart text-2xl"></i>
            <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center">0</span>
        </button>
    </div>

    <!-- Item Customization Modal -->
    <div id="item-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 id="modal-title" class="text-2xl font-bold text-purple-800">Crie o seu A√ßa√≠</h3>
                <button onclick="closeItemModal()" class="text-gray-500 hover:text-red-500"><i class="fas fa-times text-2xl"></i></button>
            </div>
            <div id="modal-body" class="p-6 space-y-6 overflow-y-auto modal-body">
                <!-- Toppings will be dynamically injected by JavaScript -->
            </div>
            <div class="p-4 bg-gray-50 border-t flex justify-between items-center">
                <div>
                    <span class="text-lg font-medium text-gray-700">Total do Artigo:</span>
                    <span id="modal-item-total" class="text-2xl font-bold text-purple-700 ml-2">0,00 ‚Ç¨</span>
                </div>
                <button id="add-to-cart-btn" class="bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition-all flex items-center gap-2">
                    <i class="fas fa-cart-plus"></i> Adicionar ao Cesto
                </button>
            </div>
        </div>
    </div>

    <!-- Cart and Checkout Modal -->
    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
         <div class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-2xl font-bold text-purple-800">O seu Cesto e Encomenda</h3>
                <button onclick="toggleCartModal()" class="text-gray-500 hover:text-red-500"><i class="fas fa-times text-2xl"></i></button>
            </div>
            <div class="p-6 space-y-6 overflow-y-auto modal-body">
                <div id="cart-items-container">
                    <!-- Cart items will be dynamically injected here -->
                </div>
                <div id="checkout-form" class="space-y-4 pt-6 border-t hidden">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Informa√ß√µes para a Entrega</h4>
                    
                    <div class="bg-purple-50 border-2 border-purple-200 p-4 rounded-lg">
                        <label for="customer-address" class="flex items-center gap-2 text-base font-bold text-purple-800">
                            <i class="fas fa-map-marker-alt"></i>
                            Morada Completa para a Entrega
                        </label>
                        <p class="text-xs text-gray-500 mb-2 ml-6">Rua, N√∫mero, Freguesia, Ponto de Refer√™ncia</p>
                        <input type="text" id="customer-address" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500 text-base p-2" required>
                    </div>

                    <div>
                        <label for="customer-name" class="block text-sm font-medium text-gray-700">O seu Nome</label>
                        <input type="text" id="customer-name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500" required>
                    </div>
                     <div>
                        <label for="payment-method" class="block text-sm font-medium text-gray-700">M√©todo de Pagamento</label>
                        <select id="payment-method" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500">
                            <option>MB Way</option>
                            <option>Cart√£o de Cr√©dito (na entrega)</option>
                            <option>Cart√£o de D√©bito (na entrega)</option>
                            <option>Numer√°rio</option>
                        </select>
                        <p class="mt-2 text-sm text-center text-red-600 font-bold bg-red-100 p-2 rounded-lg">Aten√ß√£o: N√£o aceitamos vales de refei√ß√£o.</p>
                    </div>
                     <div>
                        <label for="observations" class="block text-sm font-medium text-gray-700">Observa√ß√µes</label>
                        <textarea id="observations" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-purple-500 focus:border-purple-500" placeholder="Ex: Troco para 50‚Ç¨, sem cebola, etc."></textarea>
                    </div>
                </div>
            </div>
            <div class="p-4 bg-gray-50 border-t flex flex-col items-end">
                <div id="cart-summary-details" class="w-full text-right mb-2 pr-1 hidden">
                    <p class="text-sm text-gray-600">Subtotal: <span id="cart-subtotal">0,00 ‚Ç¨</span></p>
                    <p class="text-sm text-gray-600">Taxa de Entrega: <span id="cart-delivery-fee">0,00 ‚Ç¨</span></p>
                </div>
                <div class="flex justify-between items-center w-full">
                    <div>
                        <span class="text-lg font-medium text-gray-700">Total da Encomenda:</span>
                        <span id="cart-total" class="text-2xl font-bold text-purple-700 ml-2">0,00 ‚Ç¨</span>
                    </div>
                    <button onclick="finalizeOrder()" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-all flex items-center gap-2">
                        <i class="fab fa-whatsapp"></i> Finalizar Encomenda
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg text-center p-8">
            <i class="fas fa-check-circle text-green-500 text-6xl mb-4"></i>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">Encomenda Recebida!</h3>
            <p class="text-gray-600 mb-6">O seu resumo est√° pronto. Clique no bot√£o para enviar via WhatsApp e concluir a sua encomenda!</p>
            <div id="order-summary" class="text-left bg-gray-100 p-4 rounded-lg mb-6 max-h-60 overflow-y-auto modal-body">
                <!-- Order summary will be injected here -->
            </div>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                 <button onclick="sendOrderViaWhatsApp()" class="w-full bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition-all flex items-center justify-center gap-2">
                    <i class="fab fa-whatsapp"></i> Enviar Encomenda
                </button>
                <button onclick="closeConfirmationModal()" class="w-full bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg hover:bg-gray-400 transition-all">Fechar</button>
            </div>
        </div>
    </div>
    
    <!-- Custom Alert Modal -->
    <div id="alert-modal" class="alert-modal fixed inset-0 bg-black bg-opacity-50 z-[60] hidden items-center justify-center p-4 opacity-0">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm text-center p-6 transform scale-95">
            <div id="alert-icon" class="mx-auto mb-4"></div>
            <h3 id="alert-title" class="text-xl font-bold text-gray-800 mb-2">Aten√ß√£o!</h3>
            <p id="alert-message" class="text-gray-600 mb-6">Mensagem de alerta.</p>
            <button onclick="closeAlertModal()" class="w-full bg-purple-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-purple-700 transition-all">OK</button>
        </div>
    </div>


<script>
// --- DATABASE (Products and Toppings) ---
// This section holds all the data for products and toppings.
// It's structured as a JavaScript object for easy access.
const products = [
    { id: 1, name: 'Copo 300ml', price: 14.00, freeToppings: 3 },
    { id: 2, name: 'Copo 400ml', price: 17.00, freeToppings: 3 },
    { id: 3, name: 'Copo 500ml', price: 20.00, freeToppings: 3 },
    { id: 4, name: 'Barca M', price: 55.00, freeToppings: 3 },
];

const toppings = {
    free: {
        title: 'üçì Frutas e Cremes',
        items: ['Banana', 'Morango', 'Manga', 'Kiwi', 'Uva', 'Anan√°s', 'Creme de Leite Ninho', 'Creme de Cupua√ßu', 'Mousse de Maracuj√°', 'Creme de Avel√£']
    },
    caldas: {
        title: 'üçØ Caldas',
        limit: 1,
        items: ['Leite Condensado', 'Calda de Chocolate', 'Calda de Morango', 'Calda de Caramelo', 'Mel']
    },
    paid_tier1: {
        title: 'üåæ Gr√£os e Cereais',
        limit: 2,
        items: ['Granola Tradicional', 'Granola de Chocolate', 'Aveia', 'Flocos de Arroz', 'Pa√ßoca', 'Leite em P√≥', 'Amendoim', 'Coco Ralado', 'Ovomaltine']
    },
    paid_tier2: {
        title: 'üç´ Doces e Chocolates (+ 3,00 ‚Ç¨ cada)',
        price: 3.00,
        items: ['Gotas de Chocolate', 'Confetes', 'Bis Picado', 'Ouro Branco', 'Sonho de Valsa', 'Gomas']
    },
    paid_tier3: {
        title: '‚≠ê Algo mais? (+ 4,00 ‚Ç¨ cada)',
        price: 4.00,
        items: ['Castanha de Caju', 'Nozes', 'Banana', 'Morango', 'Manga', 'Kiwi', 'Uva', 'Creme de Leite Ninho', 'Creme de Cupua√ßu', 'Mousse de Maracuj√°', 'Creme de Avel√£']
    }
};

const deliveryFee = 6.00;
const currencySymbol = '‚Ç¨';

// --- APPLICATION STATE ---
let cart = [];
let currentItem = null;
let whatsAppMessage = '';

// --- DOM ELEMENT SELECTORS ---
const productList = document.getElementById('product-list');
const itemModal = document.getElementById('item-modal');
const cartModal = document.getElementById('cart-modal');
const confirmationModal = document.getElementById('confirmation-modal');
const cartButton = document.getElementById('cart-button');
const alertModal = document.getElementById('alert-modal');

// --- HELPER FUNCTIONS ---
/**
 * Formats a number into a currency string (e.g., 14.5 -> "14,50 ‚Ç¨").
 * @param {number} value The number to format.
 * @returns {string} The formatted currency string.
 */
function formatCurrency(value) {
    return `${value.toFixed(2).replace('.', ',')} ${currencySymbol}`;
}


// --- CUSTOM ALERT FUNCTION ---
function showAlert(message, title = 'Aten√ß√£o!', isError = false) {
    document.getElementById('alert-message').textContent = message;
    document.getElementById('alert-title').textContent = title;
    const iconContainer = document.getElementById('alert-icon');
    if (isError) {
        iconContainer.innerHTML = '<i class="fas fa-exclamation-triangle text-red-500 text-5xl"></i>';
    } else {
        iconContainer.innerHTML = '<i class="fas fa-info-circle text-blue-500 text-5xl"></i>';
    }
    alertModal.classList.remove('hidden');
    setTimeout(() => {
        alertModal.classList.remove('opacity-0');
        alertModal.querySelector('div > div').classList.remove('scale-95');
    }, 10);
}

function closeAlertModal() {
    alertModal.classList.add('opacity-0');
    alertModal.querySelector('div > div').classList.add('scale-95');
    setTimeout(() => {
        alertModal.classList.add('hidden');
    }, 300);
}


// --- RENDER FUNCTIONS (Updating the UI) ---
function renderProducts() {
    productList.innerHTML = '';
    products.forEach(product => {
        const productCard = `
            <div class="border border-gray-200 rounded-xl p-4 text-center transition-all hover:shadow-lg hover:border-purple-500 cursor-pointer flex flex-col justify-between" onclick="openItemModal(${product.id})">
                <div>
                    <h3 class="font-bold text-xl text-gray-800">${product.name}</h3>
                    <p class="text-2xl font-semibold text-purple-700 mt-2">${formatCurrency(product.price)}</p>
                </div>
                <button class="mt-4 bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-purple-700 transition-all w-full">Criar</button>
            </div>
        `;
        productList.innerHTML += productCard;
    });
}

function renderCart() {
    const cartContainer = document.getElementById('cart-items-container');
    const checkoutForm = document.getElementById('checkout-form');
    const cartSummaryDetails = document.getElementById('cart-summary-details');

    if (cart.length === 0) {
        cartContainer.innerHTML = '<p class="text-gray-500 text-center">O seu cesto est√° vazio.</p>';
        checkoutForm.classList.add('hidden');
        cartSummaryDetails.classList.add('hidden');
    } else {
        checkoutForm.classList.remove('hidden');
        cartSummaryDetails.classList.remove('hidden');
        cartContainer.innerHTML = cart.map((item, index) => `
            <div class="flex items-start justify-between p-4 border-b">
                <div>
                    <p class="font-bold text-lg text-gray-800">${item.name} (x${item.quantity})</p>
                    <div class="text-sm text-gray-600 pl-2 mt-1">
                        ${item.toppings.length > 0 ? item.toppings.map(t => `<span>- ${t.name} ${t.price > 0 ? `(+ ${formatCurrency(t.price)})` : ''}</span>`).join('<br>') : '<span>- A√ßa√≠ puro</span>'}
                    </div>
                </div>
                <div class="text-right">
                    <p class="font-bold text-lg text-purple-700">${formatCurrency(item.price * item.quantity)}</p>
                    <div class="flex items-center gap-2 mt-2">
                        <button onclick="updateQuantity(${index}, -1)" class="bg-gray-200 w-7 h-7 rounded-full font-bold text-lg flex items-center justify-center">-</button>
                        <span class="font-bold w-5 text-center">${item.quantity}</span>
                        <button onclick="updateQuantity(${index}, 1)" class="bg-gray-200 w-7 h-7 rounded-full font-bold text-lg flex items-center justify-center">+</button>
                        <button onclick="removeFromCart(${index})" class="text-red-500 hover:text-red-700 ml-2"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    const itemsTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const finalTotal = itemsTotal > 0 ? itemsTotal + deliveryFee : 0;

    document.getElementById('cart-subtotal').textContent = formatCurrency(itemsTotal);
    document.getElementById('cart-delivery-fee').textContent = formatCurrency(deliveryFee);
    document.getElementById('cart-total').textContent = formatCurrency(finalTotal);
    updateCartIcon();
}

// --- MODAL LOGIC ---
function openItemModal(productId) {
    const product = products.find(p => p.id === productId);
    currentItem = {
        id: productId,
        name: product.name,
        basePrice: product.price,
        price: product.price,
        quantity: 1,
        toppings: [],
        freeToppingLimit: product.freeToppings
    };

    document.getElementById('modal-title').textContent = `Crie o seu ${product.name}`;
    const modalBody = document.getElementById('modal-body');
    modalBody.innerHTML = '';

    Object.entries(toppings).forEach(([key, category]) => {
        const section = document.createElement('div');
        
        let categoryTitle = category.title;
        if (key === 'free') {
            categoryTitle = `${category.title} (escolha at√© ${product.freeToppings} op√ß√µes gr√°tis)`;
        } else if (category.limit) {
            categoryTitle = `${category.title} (escolha at√© ${category.limit} op√ß${category.limit > 1 ? '√µes' : '√£o'} gr√°tis)`;
        }

        let itemsHTML = category.items.map(item => `
            <label class="flex items-center space-x-3 p-2 rounded-md hover:bg-gray-100 cursor-pointer">
                <input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-purple-600 focus:ring-purple-500" name="${key}" value="${item}" data-price="${category.price || 0}">
                <span>${item}</span>
            </label>
        `).join('');

        section.innerHTML = `
            <h4 class="text-lg font-bold text-gray-700 mb-2 pb-1 border-b">${categoryTitle}</h4>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-2">${itemsHTML}</div>
        `;
        modalBody.appendChild(section);
    });
    
    modalBody.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', updateModalItemTotal);
    });

    updateModalItemTotal();
    itemModal.classList.remove('hidden');
    itemModal.classList.add('flex');
}

function closeItemModal() {
    itemModal.classList.add('hidden');
    itemModal.classList.remove('flex');
    currentItem = null;
}

function updateModalItemTotal() {
    let totalFromToppings = 0;
    const currentToppingsList = [];
    
    let freebiesUsed = document.querySelectorAll('#modal-body input[name="free"]:checked').length;
    let caldasUsed = document.querySelectorAll('#modal-body input[name="caldas"]:checked').length;
    let graosUsed = document.querySelectorAll('#modal-body input[name="paid_tier1"]:checked').length;

    document.querySelectorAll('#modal-body input[name="free"]').forEach(cb => { cb.disabled = !cb.checked && freebiesUsed >= currentItem.freeToppingLimit; });
    document.querySelectorAll('#modal-body input[name="caldas"]').forEach(cb => { cb.disabled = !cb.checked && caldasUsed >= toppings.caldas.limit; });
    document.querySelectorAll('#modal-body input[name="paid_tier1"]').forEach(cb => { cb.disabled = !cb.checked && graosUsed >= toppings.paid_tier1.limit; });

    document.querySelectorAll('#modal-body input[type="checkbox"]:checked').forEach(checkbox => {
        const price = parseFloat(checkbox.dataset.price);
        if (price > 0) {
            totalFromToppings += price;
        }
        currentToppingsList.push({ name: checkbox.value, price: price });
    });
    
    currentItem.price = currentItem.basePrice + totalFromToppings;
    currentItem.toppings = currentToppingsList.sort((a, b) => a.price - b.price);
    document.getElementById('modal-item-total').textContent = formatCurrency(currentItem.price);
}

function toggleCartModal() {
    if (!cartModal.classList.contains('flex')) {
        renderCart();
    }
    cartModal.classList.toggle('hidden');
    cartModal.classList.toggle('flex');
}

function closeConfirmationModal() {
    confirmationModal.classList.add('hidden');
    confirmationModal.classList.remove('flex');
}

// --- CART LOGIC ---
document.getElementById('add-to-cart-btn').addEventListener('click', () => {
    const existingItemIndex = cart.findIndex(item => {
        if (item.id !== currentItem.id || item.toppings.length !== currentItem.toppings.length) return false;
        const currentToppingsSet = new Set(currentItem.toppings.map(t => t.name));
        const existingToppingsSet = new Set(item.toppings.map(t => t.name));
        if (currentToppingsSet.size !== existingToppingsSet.size) return false;
        return [...currentToppingsSet].every(t => existingToppingsSet.has(t));
    });

    if (existingItemIndex > -1) {
        cart[existingItemIndex].quantity++;
    } else {
        cart.push({ ...currentItem });
    }
    
    closeItemModal();
    if (cartModal.classList.contains('flex')) {
        renderCart();
    }
    updateCartIcon();
});

function updateQuantity(index, change) {
    if (cart[index].quantity + change > 0) {
        cart[index].quantity += change;
    } else {
        removeFromCart(index);
    }
    renderCart();
}

function removeFromCart(index) {
    cart.splice(index, 1);
    renderCart();
}

function updateCartIcon() {
    const cartCountEl = document.getElementById('cart-count');
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    cartCountEl.textContent = totalItems;
    if (totalItems > 0) {
        cartButton.classList.remove('hidden');
    } else {
         cartButton.classList.add('hidden');
         if (cartModal.classList.contains('flex')) {
             toggleCartModal();
         }
    }
}

// --- ORDER FINALIZATION LOGIC ---
function finalizeOrder() {
    if (cart.length === 0) {
        showAlert('O seu cesto est√° vazio!', 'Cesto Vazio', true);
        return;
    }
    const name = document.getElementById('customer-name').value.trim();
    const address = document.getElementById('customer-address').value.trim();
    const payment = document.getElementById('payment-method').value;
    const obs = document.getElementById('observations').value.trim();

    if (!name || !address) {
        showAlert('Por favor, preencha o seu Nome e Morada para continuar.', 'Dados Incompletos', true);
        return;
    }

    let summary = `*NOVA ENCOMENDA - SABOR A√áA√çTERIA*\n\n`;
    summary += `*Cliente:* ${name}\n`;
    summary += `*Morada:* ${address}\n\n`;
    summary += `*ARTIGOS DA ENCOMENDA:*\n`;
    summary += `------------------------\n`;

    cart.forEach(item => {
        summary += `*${item.quantity}x ${item.name}*\n`;
        if (item.toppings.length > 0) {
            item.toppings.forEach(t => {
                summary += `  - ${t.name}\n`;
            });
        } else {
            summary += `  - A√ßa√≠ puro\n`;
        }
        summary += `Subtotal do artigo: ${formatCurrency(item.price * item.quantity)}\n`;
        summary += `------------------------\n`;
    });

    const itemsTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const finalTotal = itemsTotal + deliveryFee;

    summary += `\n*Subtotal dos Artigos: ${formatCurrency(itemsTotal)}*\n`;
    summary += `*Taxa de Entrega: ${formatCurrency(deliveryFee)}*\n`;
    summary += `*TOTAL DA ENCOMENDA: ${formatCurrency(finalTotal)}*\n`;
    summary += `*M√©todo de Pagamento:* ${payment}\n`;
    if (obs) {
        summary += `*Observa√ß√µes:* ${obs}\n`;
    }

    whatsAppMessage = encodeURIComponent(summary);
    document.getElementById('order-summary').innerHTML = summary.replace(/\n/g, '<br>').replace(/\*(.*?)\*/g, '<strong>$1</strong>');
    
    toggleCartModal();
    confirmationModal.classList.remove('hidden');
    confirmationModal.classList.add('flex');
}

function sendOrderViaWhatsApp() {
    // ATEN√á√ÉO: Substitua este n√∫mero pelo n√∫mero de WhatsApp correto para Portugal (ex: 351XXXXXXXXX)
    const yourNumber = '351912345678'; 
    
    const url = `https://wa.me/${yourNumber}?text=${whatsAppMessage}`;
    window.open(url, '_blank');
    
    cart = [];
    closeConfirmationModal();
    renderCart();
    document.getElementById('checkout-form').reset();
    document.getElementById('customer-name').value = '';
    document.getElementById('customer-address').value = '';
    document.getElementById('observations').value = '';
}


// --- INITIALIZATION ---
window.onload = () => {
    renderProducts();
    updateCartIcon();
};

</script>
</body>
</html>

